<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MLCompilerBridge: LLVM Inference Engine</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../clipboard.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">MLCompilerBridge
   </div>
   <div id="projectbrief">Tools for streamlining communication with ML models for compiler optimizations.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">LLVM Inference Engine</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md3"></a> This directory contains the source code for LLVM Inference Engine. A ONNX based framework to support integrtion of trained models with LLVM pass.</p>
<h1><a class="anchor" id="autotoc_md4"></a>
Trained model integration</h1>
<p>Integration of a trained model happnes in two steps.</p>
<ul>
<li>Step 1: The model trained on some native environment need to be exported in ONNX format</li>
<li>Step 2: The model can be quried anywhere in the LLVM environment by creating a instance of ONNXModel class provired by passing ONNX model file path</li>
</ul>
<h1><a class="anchor" id="autotoc_md5"></a>
Directory structure</h1>
<p>The direcory and its subdirctories contain source code for OONX model integrations as well as base classes of vaious components used by and RL algorithm. </p><pre class="fragment">.
├── onnx.cpp                # Defination of ONNXModel class
├── agent.cpp               # RL Agent class which will compute action by quring model
├── Include
│   ├── agent.h             # Declare RL agent class
│   ├── driver.h            # A interface class to query RL baaed model
│   ├── environment.h       # Declare a base Environment class which can be extended further
│   ├── onnx.h              # Declaration of ONNXModel class
│   └── utils.h             # Utility defination used my Agent class
└── CMakeLists.txt          # Build file for LLVM Inference Engine
</pre><p> The classes can be further inherited to implement the pass related logic.</p>
<h1><a class="anchor" id="autotoc_md6"></a>
Example Usage:</h1>
<h3><a class="anchor" id="autotoc_md7"></a>
RL Agent Class</h3>
<p>The below example show how a RL agent can create a instance of ONNXModel class and query it at the time of computing action.</p>
<div class="fragment"><div class="line"> ++</div>
<div class="line"><span class="preprocessor">#include &quot;agent.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;onnxUtil.h&quot;</span></div>
<div class="line"> </div>
<div class="line">Agent::Agent(std::string modelPath, <span class="keywordtype">int</span> inputSize) {</div>
<div class="line"> this-&gt;model = <span class="keyword">new</span> ONNXModel(modelPath.c_str());</div>
<div class="line"> this-&gt;inputSize = inputSize;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">unsigned</span> Agent::computeAction(Observation &amp;input) {</div>
<div class="line"> ...</div>
<div class="line"> this-&gt;model-&gt;run(input, model_output);</div>
<div class="line"> ...</div>
<div class="line">return argmaxVal;</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md8"></a>
RL InferenceEngine Class</h3>
<p>The below example showing a demo class to query the RL model, which can be called from pass. DriverService class is defined by inherithing InferenceEngine base class. It will also define the supporting fuction e.g. getPredictions which will query the ONNXModel and return the responce.</p>
<div class="fragment"><div class="line"> ++</div>
<div class="line"><span class="preprocessor">#include &quot;inference-engine.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>DriverService : <span class="keyword">public</span> InferenceEngine {</div>
<div class="line"> </div>
<div class="line">InferenceEngine(MultiAgentEnv* env) {</div>
<div class="line"> setEnvironment(env);</div>
<div class="line"> addAgent(<span class="keyword">new</span> Agent(agentModelPath, agentObsSize),<span class="stringliteral">&quot;Agent name&quot;</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">InferenceEngine(std::string modelPath, <span class="keywordtype">int</span> inputSize) {</div>
<div class="line"> <span class="comment">// Creat instance of ONNXModel</span></div>
<div class="line"> this-&gt;model = <span class="keyword">new</span> ONNXModel(modelPath.c_str());</div>
<div class="line"> this-&gt;inputSize = inputSize;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> getPredictions(PassData &amp;passData, OptInfo &amp;predictions) {</div>
<div class="line"> <span class="comment">// Logic to query model and return prediction goes here</span></div>
<div class="line"> ...</div>
<div class="line">}</div>
<div class="line">};</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md9"></a>
Integration with LLVM Pass</h3>
<p>The below example show how to call the InferenceEngine from a LLVM Pass.</p>
<div class="fragment"><div class="line"> ++</div>
<div class="line"><span class="preprocessor">#include &quot;environment.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;driver-service.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>Hello : <span class="keyword">public</span> FunctionPass, <a class="code hl_struct" href="../../d0/d3c/structEnvironment.html">Environment</a> {</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">bool</span> runOnFunction(Function &amp;F)<span class="keyword"> override </span>{</div>
<div class="line"> ...</div>
<div class="line"> <span class="comment">// Creates instance of DriverService with InferenceEngine as parent class</span></div>
<div class="line"> InferenceEngine* inference_driver = <span class="keyword">new</span> DriverService(<a class="code hl_struct" href="../../d0/d3c/structEnvironment.html">Environment</a>* env);</div>
<div class="line"> inference_driver-&gt;getPredictions(PassData passData, OptInfo &amp;predictions);</div>
<div class="line"> ...</div>
<div class="line">}</div>
<div class="ttc" id="astructEnvironment_html"><div class="ttname"><a href="../../d0/d3c/structEnvironment.html">Environment</a></div><div class="ttdef"><b>Definition</b> <a href="../../dd/dbf/ONNXModelRunnerCWrapper_8cpp_source.html#l00026">ONNXModelRunnerCWrapper.cpp:26</a></div></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
