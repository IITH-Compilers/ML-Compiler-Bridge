<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MLCompilerBridge: ML-Compiler-Bridge</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">MLCompilerBridge
   </div>
   <div id="projectbrief">Tools for streamlining communication with ML models for compiler optimizations.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">ML-Compiler-Bridge </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_README"></a> <code>ML-Compiler-Bridge</code> is a compiler agnostic library to aid in ML-Enabled Compiler Optimizations. ML-Compiler-Bridge supports both training and inference scenarios. Library exposes Python and C/C++ APIs to interface with the Python-based ML models and a C/C++ compiler. This design allows ML model development within a traditional Python framework while making end-to-end integration with an optimizing compiler possible and efficient.</p>
<p>This repo contains the source code and relevant information described in our paper, <a href="https://arxiv.org/abs/2311.10800">"The Next 700 ML-Enabled Compiler Optimizations"</a>. Please see <a href="https://iith-compilers.github.io/ML-Compiler-Bridge/">here</a> for documentation and other details.</p>
<blockquote class="doxtable">
<p>&zwj;The Next 700 ML-Enabled Compiler Optimizations, S. VenkataKeerthy, Siddharth Jain, Umesh Kalvakuntla, Pranav Sai Gorantla, Rajiv Shailesh Chitale, Eugene Brevdo, Albert Cohen, Mircea Trofin and Ramakrishna Upadrasta. CC 2024. </p>
</blockquote>
<p><a href="https://github.com/IITH-Compilers/MLCompilerBridge/actions/workflows/build.yml"><img src="https://github.com/IITH-Compilers/MLCompilerBridge/actions/workflows/build.yml/badge.svg" alt="Build and Tests" style="pointer-events: none;" class="inline"/></a> <a href="https://github.com/IITH-Compilers/MLCompilerBridge/actions/workflows/main.yml"><img src="https://github.com/IITH-Compilers/MLCompilerBridge/actions/workflows/main.yml/badge.svg" alt="Doxygen Action" style="pointer-events: none;" class="inline"/></a> <a href="https://github.com/IITH-Compilers/MLCompilerBridge/actions/workflows/formatting.yml"><img src="https://github.com/IITH-Compilers/MLCompilerBridge/actions/workflows/formatting.yml/badge.svg" alt="pre-commit checks" style="pointer-events: none;" class="inline"/></a></p>
<p><img src="https://github.com/IITH-Compilers/ML-Compiler-Bridge/raw/main/images/component-ml-compiler-bridge.png" alt="Image" class="inline"/></p>
<h1><a class="anchor" id="autotoc_md15"></a>
Features</h1>
<ul>
<li><b>Unified Framework:</b> Comes with a suite of two inter-process and two in-process model runners and three serialization-deserialization mechanisms to support interleaved and non-interleaved communication between models and compiler.</li>
<li><b>Multi-language Support:</b> Exposes C++ and C APIs to interface model runners and serializers with the compilers and Python APIs to interface inter-process model runners with ML models.</li>
<li><b>Compiler and ML-Framework Independence:</b> Provides compiler and ML-Framework independent APIs, and supports easier integration with compilers like LLVM, MLIR, and Pluto and ML Frameworks like TensorFlow, PyTorch, JAX, etc.</li>
<li><b>Deeper Integration:</b> Enables deeper integration of ML models within the compiler in a framework-independent manner to support easier inference in case of ML driven compiler optimizations.</li>
</ul>
<h1><a class="anchor" id="autotoc_md16"></a>
Requirements</h1>
<ul>
<li>cmake (&gt;= 3.10)</li>
<li>GNU Make (4.2.1)</li>
<li>LLVM (10.X) - <a href="https://github.com/llvm/llvm-project/tree/release/10.x">src</a>, <a href="https://releases.llvm.org/download.html#10.0.1">release</a></li>
<li>Python (3.10), C++17</li>
<li>gRPC v1.34 and protobuf v3.13 - for gRPC Model Runner<ul>
<li>Building GRPC from Source: Please follow <a href="https://grpc.io/docs/languages/cpp/quickstart/"><code>Build GRPC with cmake</code></a> v1.34 (protobuf v3.13) to build GRPC from source.</li>
<li>In the above tutorial setting <code>DCMAKE_INSTALL_PREFIX</code> may not be necessary and the default install prefix can be used.</li>
<li>The following dependencies will be required for Python: <code>pip install grpcio-tools</code>.</li>
</ul>
</li>
<li><a href="https://github.com/microsoft/onnxruntime/releases">ONNXRuntime</a> v1.13.1</li>
<li>TensorFlow - for TF Model Runner (AOT flow)<ul>
<li>Tested with TensorFlow 2.13.0</li>
</ul>
</li>
<li>Other python requirements are available in <a href="./mlbridge.yml">mlbridge.yml</a><ul>
<li>Conda/Anaconda based virtual environment is assumed</li>
</ul>
</li>
</ul>
<p>(Experiments are done on an Ubuntu 20.04 machine)</p>
<h1><a class="anchor" id="autotoc_md17"></a>
Setup</h1>
<p><code>ML-Compiler-Bridge</code> can be built as a stand-alone library to generate <code>.a</code> files that can in turn be linked with any compiler.</p><ol type="1">
<li><code>mkdir build &amp;&amp; cd build</code></li>
<li><code>cmake [-DCMAKE_BUILD_TYPE=Release|Debug] [-DCMAKE_INSTALL_PREFIX=&lt;Install_path&gt;] -DONNXRUNTIME_ROOTDIR=&lt;Path to ONNX install dir&gt; -DPROTOS_DIRECTORY=&lt;Path to protobuf files&gt; -DTENSORFLOW_AOT_PATH=&lt;Path to TensorFlow pip install dir&gt; ../</code></li>
<li><code>make -j [&amp;&amp; make install]</code></li>
</ol>
<p>This process would generate <code>libMLCompilerBridge.a</code> and <code>libMLCompilerBridgeC.a</code> libraries under <code>build/lib</code> directory, required headers under <code>build/include</code> directory. <code>libMLCompilerBridgeC.a</code> exposes C APIs for using with C-based compilers like Pluto, where as <code>libMLCompilerBridge.a</code> exposes C++ APIs that can be used with any compiler written in C++.</p>
<p>Python end points are available under <a href="./CompilerInterface/"><code>CompilerInterface</code></a>.</p>
<p>To ensure the correctness, run <code>make verify-all</code></p>
<h2><a class="anchor" id="autotoc_md18"></a>
Using ML-Compiler-Bridge with LLVM and MLIR</h2>
<p><code>ML-Compiler-Bridge</code> can be integrated and built along with the LLVM project. This can be done by adding this repository as a new project and setting <code>LLVM_MLBRIDGE</code> option to <code>ON</code>.</p>
<p>You can check the <a href="https://github.com/IITH-Compilers/ml-llvm-project/blob/mlbridge-lib/llvm/CMakeLists.txt">CMakeLists.txt</a> of the <a href="https://github.com/IITH-Compilers/ml-llvm-project/tree/mlbridge-lib"><code>ml-llvm-project</code></a> repository which demonstrates such an integration.</p>
<p>The passes that need to make use of this library can then just link with <code>LLVMMLBridge</code>.</p>
<p>Example <code>CMakeLists.txt</code> of an LLVM pass that would use the library is shown below.</p>
<div class="fragment"><div class="line"> .txt</div>
<div class="line">add_llvm_component_library(LLVMMLPass</div>
<div class="line">pass.cpp</div>
<div class="line">ml.cpp</div>
<div class="line"> </div>
<div class="line">ADDITIONAL_HEADER_DIRS</div>
<div class="line">  ${CMAKE_CURRENT_SOURCE_DIR}/includes</div>
<div class="line"> </div>
<div class="line">DEPENDS</div>
<div class="line">  LLVMMLBridge</div>
<div class="line">  intrinsics_gen</div>
<div class="line">)</div>
<div class="line">target_link_libraries(LLVMMLPass PRIVATE LLVMMLBridge)</div>
</div><!-- fragment --><p> To use TensorFlow AOT Model Runner, you need to make use of <code>tf_find_and_compile</code> method exposed in <a href="cmake/modules/TensorFlowCompile.cmake"><code>cmake/modules/TensorFlowCompile.cmake</code></a> in the CMakeLists.txt of your pass with appropriate arguments. An example of integrating TF AOT Model with inlining pass is shown <a href="https://github.com/IITH-Compilers/ml-llvm-project/blob/tfmodel/llvm/lib/Analysis/CMakeLists.txt">here</a>.</p>
<h1><a class="anchor" id="autotoc_md19"></a>
Artifacts</h1>
<p>Libraries are autogenerated for every relevant check-in with GitHub actions. Such generated artifacts are tagged along with the successful runs of [<code>Publish</code>]() action.</p>
<h1><a class="anchor" id="autotoc_md20"></a>
Citation</h1>
<div class="fragment"><div class="line">@inproceedings{venkatakeerthy-2024-MLCompilerBridge,</div>
<div class="line">author = {VenkataKeerthy, S. and Jain, Siddharth and Kalvakuntla, Umesh and Gorantla, Pranav Sai and Chitale, Rajiv Shailesh and Brevdo, Eugene and Cohen, Albert and Trofin, Mircea and Upadrasta, Ramakrishna},</div>
<div class="line">title = {The Next 700 ML-Enabled Compiler Optimizations},</div>
<div class="line">year = {2024},</div>
<div class="line">isbn = {9798400705076},</div>
<div class="line">publisher = {Association for Computing Machinery},</div>
<div class="line">address = {New York, NY, USA},</div>
<div class="line">url = {https://doi.org/10.1145/3640537.3641580},</div>
<div class="line">doi = {10.1145/3640537.3641580},</div>
<div class="line">booktitle = {Proceedings of the 33rd ACM SIGPLAN International Conference on Compiler Construction},</div>
<div class="line">pages = {238–249},</div>
<div class="line">numpages = {12},</div>
<div class="line">keywords = {Machine Learning for Compiler Optimizations, ONNX, Pipes, TensorFlow AOT, gRPC},</div>
<div class="line">location = {&lt;conf-loc&gt;, &lt;city&gt;Edinburgh&lt;/city&gt;, &lt;country&gt;United Kingdom&lt;/country&gt;, &lt;/conf-loc&gt;},</div>
<div class="line">series = {CC 2024}</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md21"></a>
Contributions</h1>
<p>Please feel free to raise issues to file a bug, pose a question, or initiate any related discussions. Pull requests are welcome :)</p>
<h1><a class="anchor" id="autotoc_md22"></a>
License</h1>
<p>ML-Compiler-Bridge is released under Apache 2.0 license with LLVM Exceptions. See LICENSE file for more details. </p>
</div></div><!-- PageDoc -->
<a href="doxygen_crawl.html"/>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
